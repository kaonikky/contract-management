# Система управления контрактами - Backend API

API сервер для системы управления корпоративными контрактами, разработанный на FastAPI.

## Описание

Система предназначена для юридических отделов компаний и позволяет эффективно управлять юридическими документами, отслеживать сроки действия контрактов и назначать ответственных юристов.

### Основные возможности:

- Управление пользователями (администраторы и юристы)
- Управление контрактами с полной историей изменений
- Автоматическое отслеживание сроков действия контрактов
- Статистика по контрактам (общая и по юристам)
- Поиск и фильтрация по различным параметрам
- API-интерфейс с полной документацией (Swagger UI)

## Технологии

- Python 3.11
- FastAPI (основной фреймворк)
- SQLAlchemy ORM
- PostgreSQL (база данных)
- Alembic (миграции базы данных)
- Pydantic (валидация данных)
- JWT (аутентификация)
- Google Sheets API (для миграции данных)

## Установка

### Требования

- Python 3.10+
- PostgreSQL

### Шаги установки для разработки

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/yourusername/contract-management.git
   cd contract-management/backend
   ```

2. Создать и активировать виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # для Linux/macOS
   venv\Scripts\activate     # для Windows
   ```

3. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Создать файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл, указав правильные настройки подключения к базе данных
   ```

5. Запустить приложение:
   ```bash
   python run.py
   ```

Приложение будет доступно по адресу: http://localhost:8000

API документация: http://localhost:8000/docs

## Структура проекта

```
backend/
├── app/                  # Основной код приложения
│   ├── core/             # Основные компоненты (аутентификация, безопасность)
│   ├── database/         # Настройки базы данных
│   ├── models/           # SQLAlchemy модели
│   ├── routers/          # API эндпоинты (маршруты)
│   ├── schemas/          # Pydantic схемы
│   ├── services/         # Бизнес-логика
│   └── main.py           # Точка входа FastAPI приложения
├── migrations/           # Миграции Alembic
├── alembic.ini           # Конфигурация Alembic
├── migration_tool.py     # Инструмент миграции из Google Sheets
├── requirements.txt      # Зависимости проекта
├── run.py                # Скрипт запуска приложения
└── .env.example          # Пример файла с переменными окружения
```

## API Эндпоинты

### Аутентификация

- `POST /api/login` - Вход в систему
- `POST /api/token` - Получение JWT-токена (OAuth2)
- `POST /api/register` - Регистрация нового пользователя
- `GET /api/me` - Информация о текущем пользователе

### Пользователи

- `GET /api/users` - Список пользователей (только для администраторов)
- `GET /api/users/{user_id}` - Информация о пользователе
- `GET /api/users/{user_id}/stats` - Статистика пользователя по контрактам
- `POST /api/users` - Создание пользователя (только для администраторов)
- `PUT /api/users/{user_id}` - Обновление пользователя
- `PUT /api/users/{user_id}/password` - Обновление пароля
- `DELETE /api/users/{user_id}` - Удаление пользователя (только для администраторов)

### Контракты

- `GET /api/contracts` - Список контрактов с фильтрацией
- `GET /api/contracts/stats` - Статистика по контрактам
- `GET /api/contracts/{contract_id}` - Информация о контракте
- `POST /api/contracts` - Создание контракта
- `PUT /api/contracts/{contract_id}` - Обновление контракта
- `DELETE /api/contracts/{contract_id}` - Удаление контракта (только для администраторов)

## Миграция данных из Google Sheets

Если у вас есть существующие данные в Google Sheets, вы можете выполнить миграцию с помощью инструмента `migration_tool.py`:

1. Создайте учетные данные сервисного аккаунта Google API
2. Добавьте путь к файлу учетных данных и ID таблицы в `.env` файл
3. Запустите миграцию:
   ```bash
   python migration_tool.py
   ```

## Развертывание на продакшене

См. файл [DEPLOYMENT.md](DEPLOYMENT.md) для подробной инструкции по развертыванию на продакшен-сервере.

## Разработка

### Создание миграций

```bash
# Создать миграцию
alembic revision --autogenerate -m "описание_миграции"

# Применить миграции
alembic upgrade head
```