# Настройка и использование DaData API

## Что такое DaData API?

DaData API - это сервис, который предоставляет актуальные справочные данные по организациям, адресам и другим юридическим сущностям. В контексте нашего приложения DaData используется для:

1. Автоматического заполнения информации о компании по ИНН
2. Поиска компаний по названию или ИНН
3. Получения юридической информации (адрес, руководитель и т.д.)

## Получение ключей DaData API

Для работы с DaData API необходимо получить два ключа: `TOKEN` и `SECRET`.

### Шаги для получения ключей:

1. Зарегистрируйтесь или войдите на сайте [dadata.ru](https://dadata.ru/)
2. Перейдите в раздел [Кабинет > API-ключи](https://dadata.ru/profile/#info)
3. Скопируйте значения "API-ключ" и "Секретный ключ"

![DaData API keys](https://i.imgur.com/3RpuKmI.png)

## Настройка переменных окружения для DaData API

### Для локальной разработки:

1. Откройте или создайте файл `.env` в директории `/backend`
2. Добавьте следующие строки, заменив `your_token` и `your_secret` на ваши ключи:

```
DADATA_TOKEN=your_token
DADATA_SECRET=your_secret
```

### Для развертывания на сервере (без Docker):

1. Создайте файл `.env` на сервере в директории с приложением
2. Добавьте те же строки с вашими ключами:

```
DADATA_TOKEN=your_token
DADATA_SECRET=your_secret
```

### Для развертывания с использованием Docker:

1. Откройте файл `.env` в корневой директории проекта
2. Добавьте или отредактируйте строки с ключами DaData:

```
# DaData API
DADATA_TOKEN=your_token
DADATA_SECRET=your_secret
```

## Проверка работоспособности DaData API

После настройки ключей можно проверить работу API следующим образом:

### Через API эндпоинты:

1. Запустите приложение
2. Войдите в систему, чтобы получить JWT-токен
3. Выполните тестовый запрос к API для поиска компании:

```bash
curl -X GET "http://localhost:8000/api/dadata/suggest?query=сбербанк" \
  -H "Authorization: Bearer ваш_jwt_токен"
```

### Через Swagger UI (документация API):

1. Откройте в браузере `http://localhost:8000/docs`
2. Авторизуйтесь, используя кнопку "Authorize" в верхней части страницы
3. Перейдите к разделу "dadata" и протестируйте любой из эндпоинтов

## Возможные проблемы и их решение

### Ошибка "Invalid token"

Проверьте правильность указанного токена в переменных окружения. Убедитесь, что токен скопирован полностью, без лишних пробелов.

### Ошибка "Secret key is required"

Некоторые методы DaData требуют не только токен, но и секретный ключ. Убедитесь, что обе переменные `DADATA_TOKEN` и `DADATA_SECRET` указаны корректно.

### Превышение лимита запросов

DaData имеет ограничения на количество запросов. При бесплатном тарифе лимиты достаточно строгие. Если вы видите ошибки о превышении лимита, рассмотрите возможность перехода на платный тариф.

## Использование DaData API в приложении

### Автозаполнение данных компании при создании договора:

1. При вводе ИНН в форме создания договора, автоматически загружаются и заполняются поля:
   - Название компании
   - Юридический адрес
   - ФИО директора

### Поиск компаний:

В приложении реализован поиск компаний по названию или ИНН, который использует DaData API для получения актуальных данных.

## Дополнительная документация

- [Официальная документация DaData API](https://dadata.ru/api/)
- [Документация Python-клиента DaData](https://github.com/hflabs/dadata-py)

## Тарифы и ограничения

DaData предлагает как бесплатные, так и платные тарифы. Для продакшен-использования рекомендуется рассмотреть платные тарифы, которые обеспечивают более высокие лимиты запросов.

Актуальную информацию о тарифах можно найти на [официальном сайте](https://dadata.ru/pricing/).